<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üê¨ Dolphin Acoustic Showcase | Dolphain</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #0a0e27 0%,
          #1a1f3a 50%,
          #0a0e27 100%
        );
        color: #fff;
        min-height: 100vh;
        overflow-x: hidden;
      }

      .hero {
        text-align: center;
        padding: 60px 20px 40px;
        background: linear-gradient(
          180deg,
          rgba(0, 212, 255, 0.1) 0%,
          transparent 100%
        );
      }

      .hero h1 {
        font-size: 3.5em;
        margin-bottom: 20px;
        background: linear-gradient(45deg, #00d4ff, #ff00ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: shimmer 3s ease-in-out infinite;
      }

      @keyframes shimmer {
        0%,
        100% {
          filter: brightness(1);
        }
        50% {
          filter: brightness(1.3);
        }
      }

      .hero p {
        font-size: 1.3em;
        color: #8892b0;
        max-width: 800px;
        margin: 0 auto 30px;
        line-height: 1.6;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        border-color: #00d4ff;
        box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
      }

      .stat-value {
        font-size: 2.5em;
        font-weight: bold;
        color: #00d4ff;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #8892b0;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .file-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 40px;
        transition: all 0.3s ease;
      }

      .file-card:hover {
        border-color: #00d4ff;
        box-shadow: 0 10px 40px rgba(0, 212, 255, 0.2);
      }

      .file-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .rank-badge {
        background: linear-gradient(45deg, #ff00ff, #00d4ff);
        color: white;
        font-size: 1.2em;
        font-weight: bold;
        padding: 10px 20px;
        border-radius: 25px;
        min-width: 80px;
        text-align: center;
      }

      .score-badge {
        background: rgba(0, 212, 255, 0.2);
        border: 2px solid #00d4ff;
        color: #00d4ff;
        font-size: 1.1em;
        font-weight: bold;
        padding: 8px 20px;
        border-radius: 20px;
      }

      .filename {
        flex: 1;
        color: #8892b0;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
        min-width: 200px;
      }

      .audio-player {
        background: rgba(0, 212, 255, 0.05);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 15px;
        padding: 25px;
        margin: 20px 0;
      }

      .player-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .player-tab {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(0, 212, 255, 0.3);
        color: #8892b0;
        padding: 8px 20px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9em;
      }

      .player-tab.active {
        background: #00d4ff;
        color: #0a0e27;
        border-color: #00d4ff;
        font-weight: bold;
      }

      .player-tab:hover:not(.active) {
        background: rgba(0, 212, 255, 0.2);
        color: #00d4ff;
      }

      /* Custom Audio Player */
      .custom-player {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .player-waveform-container {
        position: relative;
        height: 120px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        user-select: none;
        border: 2px solid rgba(0, 212, 255, 0.2);
        transition: border-color 0.3s ease;
      }

      .player-waveform-container:hover {
        border-color: rgba(0, 212, 255, 0.5);
      }

      .player-waveform-container.dragging {
        border-color: #00d4ff;
      }

      .player-waveform {
        width: 100%;
        height: 100%;
        display: block;
        object-fit: fill;
        pointer-events: none;
      }

      .player-progress-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 0%;
        height: 100%;
        background: linear-gradient(
          90deg,
          rgba(0, 212, 255, 0.4),
          rgba(255, 0, 255, 0.3)
        );
        pointer-events: none;
        border-right: 2px solid #00d4ff;
        box-shadow: 2px 0 10px rgba(0, 212, 255, 0.5);
      }

      .player-progress-overlay.no-transition {
        transition: none;
      }

      .player-controls {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .player-button {
        background: rgba(0, 212, 255, 0.2);
        border: 2px solid #00d4ff;
        color: #00d4ff;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 20px;
      }

      .player-button:hover {
        background: #00d4ff;
        color: #0a0e27;
        transform: scale(1.1);
      }

      .player-time {
        color: #8892b0;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
        min-width: 45px;
      }

      .player-timeline {
        flex: 1;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        position: relative;
        cursor: pointer;
      }

      .player-timeline-progress {
        height: 100%;
        background: linear-gradient(90deg, #00d4ff, #ff00ff);
        border-radius: 3px;
        width: 0%;
        transition: width 0.1s linear;
      }

      .player-volume {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .player-volume-slider {
        width: 80px;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        position: relative;
        cursor: pointer;
      }

      .player-volume-level {
        height: 100%;
        background: #00d4ff;
        border-radius: 3px;
        width: 70%;
      }

      audio {
        display: none;
      }

      .visualizations {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      .viz-image {
        width: 100%;
        border-radius: 15px;
        border: 1px solid rgba(0, 212, 255, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .viz-image:hover {
        transform: scale(1.02);
        border-color: #00d4ff;
        box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
      }

      .stats-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 15px;
      }

      .stat-item {
        text-align: center;
      }

      .stat-item-value {
        font-size: 1.5em;
        color: #ff00ff;
        font-weight: bold;
      }

      .stat-item-label {
        font-size: 0.8em;
        color: #8892b0;
        margin-top: 5px;
      }

      .highlight {
        background: rgba(255, 0, 255, 0.1);
        border-left: 3px solid #ff00ff;
        padding: 15px 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .highlight-label {
        color: #ff00ff;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(10px);
      }

      .modal-content {
        margin: 5% auto;
        max-width: 95%;
        max-height: 90vh;
      }

      .modal-content img {
        width: 100%;
        height: auto;
        border-radius: 10px;
      }

      .close {
        position: absolute;
        top: 30px;
        right: 50px;
        color: #fff;
        font-size: 50px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .close:hover {
        color: #00d4ff;
        transform: scale(1.2);
      }

      .loading {
        text-align: center;
        padding: 100px 20px;
        font-size: 1.5em;
        color: #8892b0;
      }

      .badge {
        display: inline-block;
        background: rgba(255, 0, 255, 0.2);
        border: 1px solid #ff00ff;
        color: #ff00ff;
        padding: 5px 15px;
        border-radius: 15px;
        font-size: 0.85em;
        margin: 5px;
        font-weight: bold;
      }

      @media (max-width: 768px) {
        .hero h1 {
          font-size: 2em;
        }
        .hero p {
          font-size: 1em;
        }
        .file-header {
          flex-direction: column;
          align-items: flex-start;
        }
        .stats-details {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      .scroll-indicator {
        text-align: center;
        padding: 20px;
        color: #8892b0;
        font-size: 0.9em;
      }

      .scroll-indicator::after {
        content: "‚ñº";
        display: block;
        margin-top: 10px;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }
    </style>
  </head>
  <body>
    <div class="hero">
      <h1>üê¨ Dolphin Acoustic Showcase</h1>
      <p>
        Explore the most fascinating dolphin vocalizations discovered through
        AI-powered analysis. Each recording features complex whistles, rich
        acoustic patterns, and remarkable communication behaviors.
      </p>
    </div>

    <div id="summary-stats" class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="stat-files">--</div>
        <div class="stat-label">Files Analyzed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-whistles">--</div>
        <div class="stat-label">Total Whistles</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-duration">--</div>
        <div class="stat-label">Total Duration (s)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-coverage">--%</div>
        <div class="stat-label">Avg Coverage</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-overlaps">--</div>
        <div class="stat-label">Multi-Dolphin Events</div>
      </div>
    </div>

    <div class="scroll-indicator">Scroll to explore individual recordings</div>

    <div class="container" id="showcase-container">
      <div class="loading">üê¨ Loading showcase data...</div>
    </div>

    <!-- Modal for full-size images -->
    <div id="imageModal" class="modal" onclick="closeModal()">
      <span class="close">&times;</span>
      <div class="modal-content">
        <img id="modalImage" src="" alt="Full size visualization" />
      </div>
    </div>

    <script>
      // Load and display showcase data
      async function loadShowcase() {
        try {
          const response = await fetch("showcase/showcase_data.json");

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          displaySummary(data.summary);
          displayFiles(data.files);
        } catch (error) {
          console.error("Error loading showcase:", error);

          // Check if this is a CORS error (file:// protocol)
          const isCorsError =
            error.message.includes("fetch") ||
            window.location.protocol === "file:";

          if (isCorsError) {
            document.getElementById("showcase-container").innerHTML = `
              <div class="loading" style="text-align: left; max-width: 800px; margin: 0 auto; line-height: 1.8;">
                <h2 style="color: #ff00ff; margin-bottom: 20px;">‚ö†Ô∏è Local Server Required</h2>
                <p style="color: #8892b0; margin-bottom: 15px;">
                  The showcase needs to be served over HTTP to load audio files and data.
                  Opening the HTML file directly (file://) won't work due to browser security.
                </p>
                <div style="background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; border-radius: 10px; padding: 20px; margin: 20px 0;">
                  <p style="color: #00d4ff; font-weight: bold; margin-bottom: 10px;">üöÄ Quick Start:</p>
                  <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; overflow-x: auto; color: #fff;">cd site/showcase
python -m http.server 8000</pre>
                  <p style="color: #8892b0; margin-top: 10px;">Then visit: <a href="http://localhost:8000/showcase.html" style="color: #00d4ff;">http://localhost:8000/showcase.html</a></p>
                </div>
                <p style="color: #8892b0;">
                  When deployed to a web server (like GitHub Pages), this will work automatically!
                </p>
              </div>
            `;
          } else {
            document.getElementById("showcase-container").innerHTML =
              '<div class="loading">‚ùå Error loading showcase data. Check console for details.</div>';
          }
        }
      }

      function displaySummary(summary) {
        document.getElementById("stat-files").textContent = summary.total_files;
        document.getElementById("stat-whistles").textContent =
          summary.total_whistles.toLocaleString();
        document.getElementById("stat-duration").textContent =
          summary.total_duration_s.toLocaleString();
        document.getElementById("stat-coverage").textContent =
          summary.avg_coverage + "%";
        document.getElementById("stat-overlaps").textContent =
          summary.total_overlaps;
      }

      function displayFiles(files) {
        const container = document.getElementById("showcase-container");
        container.innerHTML = "";

        files.forEach((file, index) => {
          const card = createFileCard(file);
          container.appendChild(card);

          // Initialize player after adding to DOM
          setTimeout(() => initializePlayer(file.rank), 100);
        });
      }

      function createFileCard(file) {
        const card = document.createElement("div");
        card.className = "file-card";

        const stats = file.stats;
        const highlights = [];

        if (stats.coverage > 70) highlights.push("High Activity");
        if (stats.overlaps > 0) highlights.push(`${stats.overlaps} Overlaps`);
        if (stats.freq_range_khz > 15) highlights.push("Wide Frequency Range");
        if (stats.whistle_count > 40) highlights.push("Rich Communication");

        card.innerHTML = `
                <div class="file-header">
                    <div class="rank-badge">Rank #${file.rank}</div>
                    <div class="filename">${file.filename}</div>
                    <div class="score-badge">Score: ${file.score.toFixed(
                      1
                    )}</div>
                </div>

                ${
                  highlights.length > 0
                    ? `
                <div class="highlight">
                    <div class="highlight-label">üåü Highlights</div>
                    ${highlights
                      .map((h) => `<span class="badge">${h}</span>`)
                      .join("")}
                </div>
                `
                    : ""
                }

                <div class="audio-player">
                    <div class="player-tabs">
                        <div class="player-tab active" onclick="switchAudio(${
                          file.rank
                        }, 'raw')">
                            üéµ Raw Audio
                        </div>
                        <div class="player-tab" onclick="switchAudio(${
                          file.rank
                        }, 'denoised')">
                            ‚ú® Denoised Audio
                        </div>
                    </div>
                    <div class="custom-player">
                        <div class="player-waveform-container" id="waveform-container-${
                          file.rank
                        }">
                            <img src="showcase/${
                              file.waveform
                            }" class="player-waveform" alt="Waveform">
                            <div class="player-progress-overlay" id="progress-${
                              file.rank
                            }"></div>
                        </div>
                        <div class="player-controls">
                            <div class="player-button" onclick="togglePlay(${
                              file.rank
                            })" id="play-btn-${file.rank}">
                                ‚ñ∂
                            </div>
                            <span class="player-time" id="current-time-${
                              file.rank
                            }">0:00</span>
                            <div class="player-timeline" onclick="seekTimeline(event, ${
                              file.rank
                            })">
                                <div class="player-timeline-progress" id="timeline-${
                                  file.rank
                                }"></div>
                            </div>
                            <span class="player-time" id="duration-${
                              file.rank
                            }">0:00</span>
                            <div class="player-volume">
                                <span style="color: #00d4ff; cursor: pointer;" onclick="toggleMute(${
                                  file.rank
                                })">üîä</span>
                                <div class="player-volume-slider" onclick="setVolume(event, ${
                                  file.rank
                                })">
                                    <div class="player-volume-level" id="volume-${
                                      file.rank
                                    }"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <audio id="audio-${file.rank}" preload="metadata">
                        <source src="showcase/${
                          file.audio_raw
                        }" type="audio/mpeg">
                        Your browser does not support audio playback.
                    </audio>
                </div>

                <div class="visualizations">
                    <img src="showcase/${
                      file.spectrogram
                    }" alt="Spectrogram" class="viz-image" 
                         onclick="openModal('showcase/${file.spectrogram}')">
                    <img src="showcase/${
                      file.waveform
                    }" alt="Waveform" class="viz-image" 
                         onclick="openModal('showcase/${file.waveform}')">
                </div>

                <div class="stats-details">
                    <div class="stat-item">
                        <div class="stat-item-value">${
                          stats.whistle_count
                        }</div>
                        <div class="stat-item-label">Whistles</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">${stats.coverage}%</div>
                        <div class="stat-item-label">Coverage</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">${stats.duration}s</div>
                        <div class="stat-item-label">Duration</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">${
                          stats.freq_range_khz
                        }</div>
                        <div class="stat-item-label">Freq Range (kHz)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">${
                          stats.whistles_per_minute
                        }</div>
                        <div class="stat-item-label">Whistles/Min</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-value">${stats.overlaps}</div>
                        <div class="stat-item-label">Overlaps</div>
                    </div>
                </div>
            `;

        return card;
      }

      // Custom Audio Player Functions
      const playerStates = {};

      function togglePlay(rank) {
        const audio = document.getElementById(`audio-${rank}`);
        const playBtn = document.getElementById(`play-btn-${rank}`);

        if (audio.paused) {
          audio.play();
          playBtn.textContent = "‚è∏";
        } else {
          audio.pause();
          playBtn.textContent = "‚ñ∂";
        }
      }

      function formatTime(seconds) {
        if (isNaN(seconds)) return "0:00";
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, "0")}`;
      }

      function updateProgress(rank, percent) {
        const progress = document.getElementById(`progress-${rank}`);
        const timeline = document.getElementById(`timeline-${rank}`);
        progress.style.width = Math.max(0, Math.min(100, percent)) + "%";
        timeline.style.width = Math.max(0, Math.min(100, percent)) + "%";
      }

      function seekToPercent(rank, percent) {
        const audio = document.getElementById(`audio-${rank}`);
        if (isNaN(audio.duration)) return;

        const wasPlaying = !audio.paused;
        audio.currentTime = Math.max(0, Math.min(1, percent)) * audio.duration;

        // Update UI immediately
        updateProgress(rank, percent * 100);
        document.getElementById(`current-time-${rank}`).textContent =
          formatTime(audio.currentTime);

        // Resume playback if it was playing
        if (wasPlaying) {
          audio.play();
        }
      }

      function setupWaveformDrag(rank) {
        const container = document.getElementById(`waveform-container-${rank}`);
        const progress = document.getElementById(`progress-${rank}`);
        let isDragging = false;

        function handleSeek(event) {
          const rect = container.getBoundingClientRect();
          const x = event.type.includes("touch")
            ? event.touches[0].clientX
            : event.clientX;
          const percent = Math.max(
            0,
            Math.min(1, (x - rect.left) / rect.width)
          );
          seekToPercent(rank, percent);
        }

        function startDrag(event) {
          isDragging = true;
          container.classList.add("dragging");
          progress.classList.add("no-transition");
          handleSeek(event);
          event.preventDefault();
        }

        function drag(event) {
          if (isDragging) {
            handleSeek(event);
            event.preventDefault();
          }
        }

        function endDrag() {
          isDragging = false;
          container.classList.remove("dragging");
          progress.classList.remove("no-transition");
        }

        // Mouse events
        container.addEventListener("mousedown", startDrag);
        document.addEventListener("mousemove", drag);
        document.addEventListener("mouseup", endDrag);

        // Touch events for mobile
        container.addEventListener("touchstart", startDrag, { passive: false });
        document.addEventListener("touchmove", drag, { passive: false });
        document.addEventListener("touchend", endDrag);

        // Store cleanup function
        playerStates[rank] = {
          cleanup: () => {
            container.removeEventListener("mousedown", startDrag);
            document.removeEventListener("mousemove", drag);
            document.removeEventListener("mouseup", endDrag);
            container.removeEventListener("touchstart", startDrag);
            document.removeEventListener("touchmove", drag);
            document.removeEventListener("touchend", endDrag);
          },
        };
      }

      function seekTimeline(event, rank) {
        const timeline = event.currentTarget;
        const rect = timeline.getBoundingClientRect();
        const percent = (event.clientX - rect.left) / rect.width;
        seekToPercent(rank, percent);
      }

      function setVolume(event, rank) {
        const audio = document.getElementById(`audio-${rank}`);
        const slider = event.currentTarget;
        const volumeLevel = document.getElementById(`volume-${rank}`);
        const rect = slider.getBoundingClientRect();
        const percent = Math.max(
          0,
          Math.min(1, (event.clientX - rect.left) / rect.width)
        );
        audio.volume = percent;
        volumeLevel.style.width = percent * 100 + "%";
      }

      function toggleMute(rank) {
        const audio = document.getElementById(`audio-${rank}`);
        const volumeLevel = document.getElementById(`volume-${rank}`);
        audio.muted = !audio.muted;
        if (audio.muted) {
          volumeLevel.style.width = "0%";
        } else {
          volumeLevel.style.width = audio.volume * 100 + "%";
        }
      }

      // Initialize player listeners
      function initializePlayer(rank) {
        const audio = document.getElementById(`audio-${rank}`);
        const progress = document.getElementById(`progress-${rank}`);
        const timeline = document.getElementById(`timeline-${rank}`);
        const currentTime = document.getElementById(`current-time-${rank}`);
        const duration = document.getElementById(`duration-${rank}`);
        const playBtn = document.getElementById(`play-btn-${rank}`);

        // Update time and progress
        audio.addEventListener("timeupdate", () => {
          if (!isNaN(audio.duration) && audio.duration > 0) {
            const percent = (audio.currentTime / audio.duration) * 100;
            updateProgress(rank, percent);
            currentTime.textContent = formatTime(audio.currentTime);
          }
        });

        // Set duration when loaded
        audio.addEventListener("loadedmetadata", () => {
          duration.textContent = formatTime(audio.duration);
        });

        // Reset button when ended
        audio.addEventListener("ended", () => {
          playBtn.textContent = "‚ñ∂";
        });

        // Handle errors
        audio.addEventListener("error", (e) => {
          console.error(`Error loading audio for rank ${rank}:`, e);
          playBtn.textContent = "‚ùå";
        });

        // Setup drag functionality
        setupWaveformDrag(rank);
      }

      function switchAudio(rank, type) {
        const audio = document.getElementById(`audio-${rank}`);
        const tabs = event.target.parentElement.querySelectorAll(".player-tab");

        tabs.forEach((tab) => tab.classList.remove("active"));
        event.target.classList.add("active");

        // Save current state
        const currentTime = audio.currentTime;
        const wasPlaying = !audio.paused;

        // Pause before switching
        audio.pause();

        // Find the file data and switch source
        fetch("showcase/showcase_data.json")
          .then((r) => r.json())
          .then((data) => {
            const file = data.files.find((f) => f.rank === rank);
            audio.src =
              type === "raw"
                ? `showcase/${file.audio_raw}`
                : `showcase/${file.audio_denoised}`;

            // When new audio is loaded, restore position and state
            audio.addEventListener("loadeddata", function restoreState() {
              audio.currentTime = currentTime;
              if (wasPlaying) {
                audio
                  .play()
                  .catch((e) => console.log("Auto-play prevented:", e));
              }
              // Remove this listener so it doesn't fire again
              audio.removeEventListener("loadeddata", restoreState);
            });

            audio.load();
          })
          .catch((e) => {
            console.error("Error switching audio:", e);
            document.getElementById(`play-btn-${rank}`).textContent = "‚ùå";
          });
      }

      function openModal(imageSrc) {
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        modal.style.display = "block";
        modalImg.src = imageSrc;
      }

      function closeModal() {
        document.getElementById("imageModal").style.display = "none";
      }

      // Close modal on Escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModal();
      });

      // Load showcase on page load
      window.addEventListener("DOMContentLoaded", loadShowcase);
    </script>
  </body>
</html>
